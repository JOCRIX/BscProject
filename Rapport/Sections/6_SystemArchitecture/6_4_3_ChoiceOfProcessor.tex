\subsection{Choice of processor} \label{subsec:MainProcessorChoice}

Based on choice of architecture and desired functions along with the specifications listed in sections \refq{subsec:MainProcessorSpecifications} and \refq{subsec:MainProcessorInterface}, it is clear that the microprocessor will be doing a significant amount of floating point operations, so the microprocessor should have an FPU and a \textit{high} clock frequency to minimize compute times. It should also have a DAC to generate a DC bias voltage for the analog front. It should have a UART to communicate with a user interface and it should have a significant amount of RAM to store the impedance, phase, frequency and derived quantities. 

The microcontroller in the project will be an STM32F446RE\cite{ST_STM32F446RE} embedded on an ST NUCLEO-F446RE\cite{ST_NUCLEOF446RE} development board. The STM32 platform is convenient for development purposes as the underlying ST hardware abstraction layer (HAL) drivers enables the team to quickly swap to a different microcontroller in case more functions are required, such as additional RAM, SPI's, GPIO's, high clock rates and so on. The STM32F446RE was chosen as it was the most capable STM32 development board available to the project team at the time. It is running at a maximum core clock frequency of \SIQ{180}{\mega\hertz}. It directly supports floating point operations, it has a DAC and plenty of I/O to connect with the other modules in the project and it is easily upgradeable if it proves insufficient later in the project.

As the microprocessor will need to communicate with the sample control module, some consideration and tests were conducted  to evaluate how quickly it can set and clear it's I/O pins, swap input states, perform bitwise operations and perform floating point operations. This can all be seen in appendix \refq{App:MicrocontrollerConsiderations}.

Specification ยง6.4.6 states that the microprocessor should be able to store 10000 impedance magnitude values, phase angle values and frequency values. The maximum frequency value is \SIQ{1}{\mega\hertz}. These are all 32bit wide variables, so the memory required is $Mem = 3\cdot 10E3 \cdot 32 = 960 kbit$ for storing these values. The STM32F446RE has \SIQ{128}{\kilo\bit} available SRAM, so additional external memory is required, this will be important in the system design.

Using the STM32F446 to directly control the sampling of the ADC's was considered, so the jitter of an output pin of the microcontroller was tested, this can also be seen in appendix \refq{App:MicrocontrollerConsiderations} on microcontroller considerations. The jitter caused by the microcontroller would cause a phase error of about 5\degree at \SIQ{1}{\mega\hertz} and this is significantly more than the system requirements specified in section \refq{ch:SystemRequirements} allow, so the microprocessor is not suitable for controlling the acquisition signals of the two ADC's as they must be triggered at the same time and with the same interval. The problem is made worse by the fact that the sampling will be done over a longer period of time.


